<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shoulder MRI MPR Viewer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #f8fafc; }
    .viewer-container {
      width: 32%;
      background: black;
      display: inline-block;
      margin: 0 1%;
      vertical-align: top;
    }
    .viewport {
      width: 100%;
      height: 512px;
    }
  </style>
</head>
<body class="p-4">

  <h1 class="text-2xl font-bold mb-4">Shoulder MRI MPR Viewer</h1>

  <div id="axial" class="viewer-container">
    <p class="text-center text-lg text-black">Axial</p>
    <div id="axial-viewport" class="viewport"></div>
  </div>

  <div id="sagittal" class="viewer-container">
    <p class="text-center text-lg text-black">Sagittal</p>
    <div id="sagittal-viewport" class="viewport"></div>
  </div>

  <div id="coronal" class="viewer-container">
    <p class="text-center text-lg text-black">Coronal</p>
    <div id="coronal-viewport" class="viewport"></div>
  </div>

  <script type="module">
    import * as cornerstone3D from "https://cdn.jsdelivr.net/npm/@cornerstonejs/core@1.11.8/dist/cornerstone-core.min.js";
    import * as cornerstoneStreaming from "https://cdn.jsdelivr.net/npm/@cornerstonejs/streaming-image-volume-loader@1.11.8/dist/cornerstone-streaming-image-volume-loader.min.js";

    const { RenderingEngine, Enums, volumeLoader } = cornerstone3D;

    // Register loader
    volumeLoader.registerVolumeLoader(
      "cornerstoneStreamingImageVolume",
      cornerstoneStreaming.streamingImageVolumeLoader
    );

    async function init() {
      await cornerstone3D.init();

      const renderingEngineId = "mprEngine";
      const renderingEngine = new RenderingEngine(renderingEngineId);

      const viewportIds = ["AXIAL", "SAGITTAL", "CORONAL"];

      // Set up viewports
      renderingEngine.setViewports([
        {
          viewportId: viewportIds[0],
          type: Enums.ViewportType.ORTHOGRAPHIC,
          element: document.getElementById("axial-viewport"),
          defaultOptions: { orientation: Enums.OrientationAxis.AXIAL }
        },
        {
          viewportId: viewportIds[1],
          type: Enums.ViewportType.ORTHOGRAPHIC,
          element: document.getElementById("sagittal-viewport"),
          defaultOptions: { orientation: Enums.OrientationAxis.SAGITTAL }
        },
        {
          viewportId: viewportIds[2],
          type: Enums.ViewportType.ORTHOGRAPHIC,
          element: document.getElementById("coronal-viewport"),
          defaultOptions: { orientation: Enums.OrientationAxis.CORONAL }
        }
      ]);

      // Load your DICOM series (replace with your image IDs)
      const volumeId = "cornerstoneStreamingImageVolume:myMRI";
      const imageIds = [
        // Replace with your actual WADO-URI or local file URLs
        "wadouri:https://your-server/dicom/file1.dcm",
        "wadouri:https://your-server/dicom/file2.dcm",
        "wadouri:https://your-server/dicom/file3.dcm"
      ];

      const volume = await volumeLoader.createAndCacheVolume(volumeId, { imageIds });
      await volume.load();

      viewportIds.forEach(vpId => {
        const vp = renderingEngine.getViewport(vpId);
        vp.setVolumes([{ volumeId }]);
        vp.render();
      });
    }

    init();
  </script>
</body>
</html>
