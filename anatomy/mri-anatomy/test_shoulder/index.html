<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Fast Shoulder MRI Viewer</title>
  <script src="https://unpkg.com/cornerstone-core/dist/cornerstone.js"></script>
  <script src="https://unpkg.com/cornerstone-wado-image-loader/dist/cornerstoneWADOImageLoader.js"></script>
  <script src="https://unpkg.com/dicom-parser/dist/dicomParser.js"></script>
  <style>
    body { margin: 0; background: black; display: flex; justify-content: center; align-items: center; height: 100vh; }
    #dicomImage { width: 90%; height: 90%; background: black; }
  </style>
</head>
<body>
  <div id="dicomImage"></div>

  <script>
    cornerstoneWADOImageLoader.external.cornerstone = cornerstone;

    const element = document.getElementById('dicomImage');
    cornerstone.enable(element);

    // Correct base path to DICOM files hosted on GitHub Pages (raw link)
    const basePath = 'https://raw.githubusercontent.com/im2famous4u/RadMentor/main/anatomy/mri-anatomy/test_shoulder/';

    const totalSlices = 280; // adjust as per your series
    let currentIndex = 1;

    async function loadAndDisplayImage(index) {
      const fileName = `IMG${String(index).padStart(4, '0')}.dcm`;
      const imageId = `wadouri:${basePath}${fileName}`;
      try {
        const image = await cornerstone.loadImage(imageId);
        cornerstone.displayImage(element, image);
      } catch (err) {
        console.error(`Error loading ${fileName}:`, err);
      }
    }

    loadAndDisplayImage(currentIndex);

    document.addEventListener('keydown', function(evt) {
      if (evt.key === 'ArrowUp' && currentIndex < totalSlices) {
        currentIndex++;
        loadAndDisplayImage(currentIndex);
      } else if (evt.key === 'ArrowDown' && currentIndex > 1) {
        currentIndex--;
        loadAndDisplayImage(currentIndex);
      }
    });
  </script>
</body>
</html>
