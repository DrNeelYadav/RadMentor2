<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRCR Physics MCQ Practice</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles to enhance the look and feel */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom radio button styling */
        .custom-radio:checked {
            background-color: #2563eb; /* blue-600 */
            border-color: #2563eb;
        }
        .custom-radio:checked::after {
            content: '';
            display: block;
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            background-color: white;
        }
        .correct-answer {
            background-color: #dcfce7; /* green-100 */
            border-left: 4px solid #22c55e; /* green-500 */
        }
        .incorrect-answer {
            background-color: #fee2e2; /* red-100 */
            border-left: 4px solid #ef4444; /* red-500 */
        }
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden">
            <div class="p-6 sm:p-8">
                <header class="mb-8">
                    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">FRCR Physics MCQ Practice</h1>
                    <p class="text-gray-500 mt-1">Select True or False for each statement below. Results will appear automatically.</p>
                </header>

                <!-- Loading Indicator -->
                <div id="loader" class="loader"></div>
                <p id="loading-text" class="text-center text-gray-500">Loading questions from Google Sheet...</p>
                
                <!-- Error Message -->
                <div id="error-message" class="hidden my-4 p-4 bg-red-100 border-l-4 border-red-500 text-red-700">
                    <p><strong>Error:</strong> Could not load questions from the Google Sheet.</p>
                    <p class="text-sm">Please ensure the sheet is published to the web as a CSV. Loading a fallback question.</p>
                </div>


                <!-- Quiz Form -->
                <form id="quiz-form" class="hidden">
                    <!-- Main Question -->
                    <div class="mb-8 p-4 bg-blue-50 border-l-4 border-blue-500 rounded-r-lg">
                         <h2 id="main-question-title" class="text-sm font-semibold text-blue-700 mb-2">Question <span id="question-number">1</span> of <span id="total-questions">1</span></h2>
                        <h2 id="main-question" class="text-xl font-semibold text-blue-800"></h2>
                    </div>

                    <!-- Sub-questions Container -->
                    <div id="sub-questions-container" class="space-y-5">
                        <!-- Sub-questions will be dynamically inserted here -->
                    </div>

                    <!-- Action Buttons -->
                    <div class="mt-10 flex flex-col sm:flex-row gap-4">
                        <button type="button" id="next-question-btn" class="w-full sm:w-auto bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 ease-in-out hidden">
                            Next Question
                        </button>
                    </div>
                </form>

                <!-- Results Section -->
                <div id="results-section" class="mt-10 hidden">
                    <h3 class="text-2xl font-bold mb-4 text-gray-900">Results</h3>
                    <div id="results-container" class="space-y-4">
                        <!-- Results will be dynamically inserted here -->
                    </div>
                     <div class="mt-6 p-4 bg-indigo-50 rounded-lg text-center">
                        <p class="text-lg font-semibold text-indigo-800">Your final score is: <span id="score"></span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- DATA ---
            // Fallback data in case the Google Sheet fails to load.
            let allQuizData = [
                {
                    mainQuestion: "Concerning the Compton effect:",
                    subQuestions: [
                        { id: "1a", text: "There is interaction between a photon and a free electron.", correctAnswer: "True", explanation: "The Compton effect is defined as the inelastic scattering of a high-energy photon by a free or loosely bound outer-shell electron." },
                        { id: "1b", text: "The larger the angle through which the photon is scattered, the more energy it loses.", correctAnswer: "True", explanation: "The energy transferred to the electron (and lost by the photon) is greatest at the maximum scattering angle of 180 degrees (backscatter)." },
                        { id: "1c", text: "The wavelength change produced depends upon the scattering material.", correctAnswer: "False", explanation: "The change in wavelength depends only on the scattering angle, not on the initial photon energy or the scattering material." },
                        { id: "1d", text: "High energy radiation is scattered more than lower energy radiation.", correctAnswer: "False", explanation: "The probability of Compton scattering (its cross-section) decreases as photon energy increases. However, it becomes the dominant interaction relative to the photoelectric effect at higher energies." },
                        { id: "1e", text: "The amount of scattering that occurs depends on the electron density of the scattering material.", correctAnswer: "True", explanation: "The probability of Compton scattering is directly proportional to the number of electrons per unit mass (electron density) of the material." }
                    ]
                }
            ];

            // --- DOM ELEMENTS ---
            const mainQuestionEl = document.getElementById('main-question');
            const subQuestionsContainer = document.getElementById('sub-questions-container');
            const nextQuestionBtn = document.getElementById('next-question-btn');
            const resultsSection = document.getElementById('results-section');
            const resultsContainer = document.getElementById('results-container');
            const scoreEl = document.getElementById('score');
            const questionNumberEl = document.getElementById('question-number');
            const totalQuestionsEl = document.getElementById('total-questions');
            const loader = document.getElementById('loader');
            const loadingText = document.getElementById('loading-text');
            const quizForm = document.getElementById('quiz-form');
            const errorMessage = document.getElementById('error-message');


            // --- STATE ---
            let isSubmitted = false;
            let currentQuestionIndex = 0;
            
            /**
             * Fetches and parses quiz data from a public Google Sheet.
             */
            async function fetchAndLoadQuiz() {
                // URL for the public Google Sheet, exported as CSV.
                // Replace with your own sheet if needed.
                const sheetId = "1zW9hT5Yy8vK2thzSzjqf8DdIM_b_fLjmO0jLk5J0ti8";
                const sheetGid = "588285606";
                const googleSheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=${sheetGid}`;

                try {
                    const response = await fetch(googleSheetUrl);
                    if (!response.ok) {
                        throw new Error('Network response was not ok. Is the sheet published to the web?');
                    }
                    const csvText = await response.text();
                    const parsedData = parseCsv(csvText);
                    
                    if(parsedData.length > 0) {
                        allQuizData = parsedData; // Overwrite fallback data
                    } else {
                         throw new Error('CSV data is empty or could not be parsed.');
                    }
                    
                } catch (error) {
                    console.error("Failed to fetch or parse Google Sheet:", error);
                    errorMessage.classList.remove('hidden'); // Show error message
                } finally {
                    // Hide loader and show the quiz form
                    loader.classList.add('hidden');
                    loadingText.classList.add('hidden');
                    quizForm.classList.remove('hidden');
                    // Initialize the quiz with either fetched or fallback data
                    loadQuiz();
                }
            }

            /**
             * A simple CSV parser.
             * Assumes the first row is headers and data doesn't contain escaped commas.
             * @param {string} csvText - The raw CSV text.
             * @returns {Array} - An array of quiz objects.
             */
            function parseCsv(csvText) {
                const rows = csvText.split(/\r?\n/);
                const headers = rows[0].split(',');
                const data = [];

                for (let i = 1; i < rows.length; i++) {
                    if (!rows[i]) continue; // Skip empty rows
                    const rowData = rows[i].split(',');
                    
                    const mainQuestion = rowData[0];
                    if (!mainQuestion) continue; // Skip rows without a main question

                    const subQuestions = [];
                    for (let j = 0; j < 5; j++) {
                        const questionText = rowData[1 + j];
                        const answer = rowData[6 + (j * 2)];
                        const explanation = rowData[7 + (j * 2)];
                        
                        if(questionText && answer && explanation) {
                             subQuestions.push({
                                id: `${i}${String.fromCharCode(97 + j)}`, // e.g., 1a, 1b
                                text: questionText,
                                correctAnswer: answer.trim(),
                                explanation: explanation.trim()
                            });
                        }
                    }
                    
                    if(subQuestions.length > 0) {
                         data.push({
                            mainQuestion: mainQuestion,
                            subQuestions: subQuestions
                        });
                    }
                }
                return data;
            }


            /**
             * Loads and displays the quiz questions on the page.
             */
            function loadQuiz() {
                isSubmitted = false;
                const quizData = allQuizData[currentQuestionIndex];

                // Update question counters
                questionNumberEl.textContent = currentQuestionIndex + 1;
                totalQuestionsEl.textContent = allQuizData.length;

                mainQuestionEl.textContent = quizData.mainQuestion;
                let subQuestionsHTML = '';
                quizData.subQuestions.forEach((sq) => {
                    subQuestionsHTML += `
                        <div class="sub-question-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 border border-gray-200 rounded-lg transition-all duration-200" id="item-${sq.id}">
                            <p class="text-md text-gray-700 mb-3 sm:mb-0 flex-1">
                                <span class="font-semibold text-gray-800">Q${sq.id}:</span> ${sq.text}
                            </p>
                            <div class="flex items-center space-x-6 shrink-0 ml-0 sm:ml-4">
                                <label class="flex items-center space-x-2 cursor-pointer text-gray-600 hover:text-blue-600">
                                    <input type="radio" name="answer${sq.id}" value="True" class="form-radio h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500 custom-radio appearance-none rounded-full border-2 p-2" required>
                                    <span>True</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer text-gray-600 hover:text-red-600">
                                    <input type="radio" name="answer${sq.id}" value="False" class="form-radio h-5 w-5 text-red-600 border-gray-300 focus:ring-red-500 custom-radio appearance-none rounded-full border-2 p-2" required>
                                    <span>False</span>
                                </label>
                            </div>
                        </div>
                    `;
                });
                subQuestionsContainer.innerHTML = subQuestionsHTML;
                // Add event listeners to the new radio buttons
                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.addEventListener('change', handleAnswerSelection);
                });
            }
            
            /**
             * Checks if all questions have been answered and triggers the result display.
             */
            function handleAnswerSelection() {
                if (isSubmitted) return; // Don't re-submit

                const quizData = allQuizData[currentQuestionIndex];
                const allAnswered = quizData.subQuestions.every(sq => {
                    return document.querySelector(`input[name="answer${sq.id}"]:checked`);
                });

                if (allAnswered) {
                    checkAnswers();
                }
            }


            /**
             * Checks the user's answers, calculates the score, and displays the results.
             */
            function checkAnswers() {
                isSubmitted = true;
                resultsContainer.innerHTML = '';
                let score = 0;
                const quizData = allQuizData[currentQuestionIndex];
                const totalQuestions = quizData.subQuestions.length;

                quizData.subQuestions.forEach(sq => {
                    const questionItemEl = document.getElementById(`item-${sq.id}`);
                    const selectedAnswerEl = document.querySelector(`input[name="answer${sq.id}"]:checked`);
                    const userAnswer = selectedAnswerEl.value;
                    const isCorrect = userAnswer === sq.correctAnswer;

                    if (isCorrect) {
                        score++;
                        questionItemEl.classList.add('correct-answer');
                    } else {
                        questionItemEl.classList.add('incorrect-answer');
                    }

                    const resultHTML = `
                        <div class="p-4 rounded-lg ${isCorrect ? 'bg-green-50 border-l-4 border-green-400' : 'bg-red-50 border-l-4 border-red-400'}">
                           <p class="font-semibold text-gray-800">A${sq.id}: The correct answer is <span class="font-bold ${isCorrect ? 'text-green-700' : 'text-red-700'}">${sq.correctAnswer}</span>.</p>
                           <p class="text-sm text-gray-600 mt-1">Your answer: ${userAnswer}.</p>
                           <p class="mt-2 text-gray-700 text-sm md:text-base">${sq.explanation}</p>
                        </div>
                    `;
                    resultsContainer.innerHTML += resultHTML;
                });

                // Display score and results
                scoreEl.textContent = `${score} / ${totalQuestions}`;
                resultsSection.classList.remove('hidden');

                // Disable form elements and show next question button
                nextQuestionBtn.classList.remove('hidden');
                if (currentQuestionIndex >= allQuizData.length - 1) {
                    nextQuestionBtn.textContent = 'Restart Quiz';
                } else {
                    nextQuestionBtn.textContent = 'Next Question';
                }

                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.disabled = true;
                });
            }

            /**
             * Resets the quiz to its initial state.
             */
            function loadNextQuestion() {
                currentQuestionIndex++;
                if (currentQuestionIndex >= allQuizData.length) {
                    currentQuestionIndex = 0; // Restart
                }

                isSubmitted = false;
                document.getElementById('quiz-form').reset();
                resultsSection.classList.add('hidden');
                resultsContainer.innerHTML = '';
                scoreEl.textContent = '';

                // Hide next question button
                nextQuestionBtn.classList.add('hidden');
                
                // Remove result styling from question items
                document.querySelectorAll('.sub-question-item').forEach(item => {
                    item.classList.remove('correct-answer', 'incorrect-answer');
                });
                
                // Reload the quiz to re-attach event listeners and enable radios
                loadQuiz();
            }

            // --- EVENT LISTENERS ---
            nextQuestionBtn.addEventListener('click', loadNextQuestion);

            // --- INITIALIZATION ---
            fetchAndLoadQuiz();
        });
    </script>

</body>
</html>

