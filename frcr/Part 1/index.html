<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Quiz Fetcher</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f0f0f0;
            color: #333;
            padding: 20px;
        }
        #results {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #ccc;
        }
        button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
        }
        .question-block {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        h3 {
            margin-top: 0;
        }
    </style>
</head>
<body>

    <h1>Quiz Data Fetcher</h1>
    <p>Click the button to fetch and display questions from the "Basic Physics" sheet.</p>
    <button id="fetch-btn">Fetch Questions</button>

    <div id="results">
        <p>Fetched data will appear here...</p>
    </div>

    <script>
        document.getElementById('fetch-btn').addEventListener('click', fetchAndDisplayQuiz);

        /**
         * Fetches data from the Google Sheet, parses it, and displays it on the page.
         */
        async function fetchAndDisplayQuiz() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Fetching data, please wait...</p>';

            // Configuration for the Google Sheet
            const sheetId = "1zW9hT5Yy8vK2thzSzjqf8DdIM_b_fLjmO0jLk5J0ti8";
            const gid = "588285606"; // This is the GID for the "Basic Physics" tab
            const url = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=${gid}`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Network response was not ok. Status: ${response.status}`);
                }
                const csvText = await response.text();
                const parsedData = parseCsv(csvText);

                if (parsedData.length === 0) {
                    resultsDiv.innerHTML = '<p>No questions found. The sheet might be empty or formatted incorrectly.</p>';
                    return;
                }

                // --- DEBUGGING ---
                // This will log the raw data to your browser's developer console (F12)
                console.log("Fetched and Parsed Data:", parsedData);
                // --- END DEBUGGING ---

                // Format and display the data on the page
                let htmlOutput = `<h2>Found ${parsedData.length} questions:</h2>`;
                parsedData.forEach((question, index) => {
                    htmlOutput += `<div class="question-block">`;
                    htmlOutput += `<h3>Q${index + 1}: ${question.mainQuestion}</h3>`;
                    htmlOutput += '<ul>';
                    question.subQuestions.forEach(sq => {
                        htmlOutput += `<li><strong>${sq.id}:</strong> ${sq.text} <em>(Answer: ${sq.correctAnswer})</em></li>`;
                    });
                    htmlOutput += '</ul>';
                    htmlOutput += `</div>`;
                });

                resultsDiv.innerHTML = htmlOutput;

            } catch (error) {
                console.error("Fetch Error:", error);
                resultsDiv.innerHTML = `<p style="color: red;"><strong>Error:</strong> Could not fetch data. Please check the console (F12) for details and ensure the Google Sheet is published to the web as a CSV.</p>`;
            }
        }

        /**
         * Parses raw CSV text into a structured array of quiz objects.
         * @param {string} csvText - The raw CSV text from the fetch response.
         * @returns {Array} An array of question objects.
         */
        function parseCsv(csvText) {
            const rows = csvText.trim().split(/\r?\n/);
            const data = [];
            // Start from row 1 to skip the header
            for (let i = 1; i < rows.length; i++) {
                if (!rows[i]) continue; // Skip empty rows

                // This regex handles fields that are quoted and may contain commas
                const rowData = rows[i].match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
                const cleanRow = rowData.map(field => field.trim().replace(/^"|"$/g, '').trim());

                if (!cleanRow[0]) continue; // Skip if the main question is empty

                const subQuestions = [];
                for (let j = 0; j < 5; j++) {
                    // Check if all required fields for a sub-question exist
                    if (cleanRow[1 + j] && cleanRow[6 + (j * 2)] && cleanRow[7 + (j * 2)]) {
                         subQuestions.push({
                            id: `${i}${String.fromCharCode(97 + j)}`,
                            text: cleanRow[1 + j],
                            correctAnswer: cleanRow[6 + (j * 2)],
                            explanation: cleanRow[7 + (j * 2)]
                        });
                    }
                }

                if (subQuestions.length > 0) {
                    data.push({ 
                        mainQuestion: cleanRow[0], 
                        subQuestions: subQuestions 
                    });
                }
            }
            return data;
        }
    </script>

</body>
</html>
